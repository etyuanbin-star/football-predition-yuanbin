import streamlit as st
import numpy as np
import plotly.graph_objects as go

# --- é¡µé¢åŸºç¡€è®¾ç½® ---
st.set_page_config(page_title="åšå½©çœŸç›¸å®éªŒå®¤", layout="centered")

# æ ‡é¢˜ä¸æ ¸å¿ƒè­¦ç¤º
st.title("ğŸ›¡ï¸ è¶³çƒå¯¹å†²æŠ•æ³¨ï¼šé£é™©å®éªŒå®¤")
st.markdown("""
    **å¾ˆå¤šçœ‹ä¼¼â€œç¨³èµšä¸èµ”â€çš„ç­–ç•¥ï¼Œå…¶å®åªæ˜¯ç²¾ç¾çš„æ•°å­¦é™·é˜±ã€‚** æœ¬å·¥å…·é€šè¿‡æ¨¡æ‹ŸçœŸå®çš„èµ”ç‡ç»“æ„ï¼Œå¸¦ä½ æ‹†è§£è¿™äº›é™·é˜±ã€‚
""")

st.divider()

# --- ä¾§è¾¹æ ï¼šæç®€è¾“å…¥ ---
with st.sidebar:
    st.header("ğŸ›ï¸ ç­–ç•¥è°ƒæ•´")
    total_investment = st.slider("æ¯åœºæ€»æŠ•å…¥ ($)", 100, 5000, 1000, step=100)
    st.divider()
    st.subheader("åº„å®¶è§†è§’ (æ ¸å¿ƒèµ”ç‡)")
    o25_odds = st.number_input("å…¨åœºå¤§çƒèµ”ç‡", 1.5, 4.0, 2.30, 0.05)
    u25_avg_odds = st.number_input("å°çƒæ¯”åˆ†å¹³å‡èµ”ç‡", 5.0, 15.0, 7.5, 0.1)
    st.info("ğŸ’¡ åº„å®¶é€šè¿‡é™ä½èµ”ç‡æ¥æ”¶å–â€˜è¿‡è·¯è´¹â€™ã€‚")

# --- æ ¸å¿ƒè®¡ç®— (ä¸ºäº†æ˜“æ‡‚ï¼Œç®€åŒ–ç®—æ³•) ---
# 1. è®¡ç®—ç†è®ºè¦†ç›–ç‡
coverage = (1/o25_odds) + (6/u25_avg_odds) 
# 2. è®¡ç®—æ¯æŠ•100å…ƒçš„é¢„æœŸç»“æœ
return_per_100 = (1 / coverage) * 100
loss_per_100 = 100 - return_per_100

# --- ä¸»ç•Œé¢ï¼šç»“æœçœ‹æ¿ ---
col1, col2 = st.columns(2)

with col1:
    st.write("### ğŸ† è¡¨é¢ç°è±¡")
    st.metric("ç»“æœè¦†ç›–ç‡", f"{min(coverage*100, 99.9):.1f}%", help="çœ‹èµ·æ¥ä½ å‡ ä¹è¦†ç›–äº†æ‰€æœ‰çš„æ¯”èµ›ç»“æœ")
    st.write("ğŸŸ¢ çœ‹èµ·æ¥åªè¦æ¯”èµ›ç»“æŸï¼Œä½ å°±èƒ½é¢†åˆ°å¥–é‡‘ã€‚")

with col2:
    st.write("### ğŸ’€ çœŸå®ä»£ä»·")
    # é¢œè‰²è­¦ç¤ºé€»è¾‘
    ev_color = "inverse" if loss_per_100 > 0 else "normal"
    st.metric("é•¿æœŸèƒœç‡(EV)", f"-{loss_per_100:.1f}%", delta_color=ev_color)
    st.write(f"ğŸ”´ å®é™…ä¸Šï¼Œä½ æ¯æŠ•å…¥100å…ƒï¼Œå¹³å‡ä¼š**äºæ‰ {loss_per_100:.1f} å…ƒ**ã€‚")

# --- åŠ¨æ€è§†è§‰å†²å‡»ï¼šèµ„é‡‘æ›²çº¿ ---
st.divider()
st.subheader("ğŸ“ˆ æ¨¡æ‹Ÿé•¿æœŸæŠ•æ³¨çš„èµ„é‡‘å˜åŒ–")
st.caption(f"å¦‚æœä½ å¸¦ç€ $10,000 è¿›åœºï¼Œè¿ç»­ç© 500 åœºåï¼š")

# æ¨¡æ‹Ÿç®—æ³•ï¼šæ ¹æ®ç›ˆäºæœŸæœ›ç”Ÿæˆæ›²çº¿
rounds = 500
# æ¨¡æ‹Ÿç»“æœï¼šå¤§éƒ¨åˆ†åœºæ¬¡å°äºï¼Œå¶å°”ä¸ä¸­å¤§äº
drift = -loss_per_100 / 100 # æ¯æ—¥å¹³å‡è·Œå¹…
volatility = 0.05 # æ³¢åŠ¨ç‡
daily_returns = np.random.normal(drift, volatility, rounds)
money_curve = 10000 * np.cumprod(1 + daily_returns)

fig = go.Figure()
fig.add_trace(go.Scatter(y=money_curve, mode='lines', line=dict(color='#FF4B4B', width=3)))
fig.update_layout(
    template="plotly_white",
    xaxis_title="æŠ•æ³¨åœºæ¬¡",
    yaxis_title="è´¦æˆ·ä½™é¢ ($)",
    margin=dict(l=0, r=0, t=0, b=0),
    height=300
)
st.plotly_chart(fig, use_container_width=True)



# --- æ·±åº¦æ‹†è§£ï¼šä¸ºä»€ä¹ˆä½ ä¼šäºï¼Ÿ ---
st.divider()
st.subheader("ğŸ” é™·é˜±æ‹†è§£")

tab1, tab2 = st.tabs(["ä¸ºä»€ä¹ˆâ€˜å…¨è¦†ç›–â€™è¿˜ä¼šäºï¼Ÿ", "åº„å®¶æ˜¯æ€ä¹ˆèµšé’±çš„ï¼Ÿ"])

with tab1:
    st.markdown("""
        1. **ä¸­å¥–ä¸ç­‰äºèµ¢é’±**ï¼šä½ è™½ç„¶æ¯åœºéƒ½é¢†åˆ°äº†å¥–é‡‘ï¼Œä½†å¥–é‡‘æ•°é¢å°äºä½ æŠ•å…¥çš„æ€»æœ¬é‡‘ã€‚
        2. **æ¦‚ç‡é”™ä½**ï¼šåº„å®¶ç»™å‡ºçš„èµ”ç‡æ€»æ˜¯æ¯”å®é™…å‘ç”Ÿçš„æ¦‚ç‡â€œç¼©æ°´â€ä¸€ç‚¹ç‚¹ã€‚
        3. **ç§¯å°‘æˆå¤š**ï¼šå•æ¬¡çœ‹å¯èƒ½åªäºå‡ å—é’±ï¼Œä½†è¿™ç§ç»“æ„æ€§äºæŸåœ¨é•¿æœŸæ˜¯æ— æ³•é€šè¿‡â€œè¿æ°”â€ç¿»èº«çš„ã€‚
    """)

with tab2:
    st.write("ä½ å¯ä»¥è¯•ç€è°ƒä½ä¾§è¾¹æ çš„èµ”ç‡ï¼ˆæ¯”å¦‚æŠŠå¤§çƒèµ”ç‡è°ƒåˆ° 2.0ï¼‰ï¼Œä½ ä¼šå‘ç°å³ä¾§çš„â€˜çœŸå®ä»£ä»·â€™ä¼šç¬é—´é£™å‡ã€‚")
    st.info("è¿™å°±æ˜¯åº„å®¶çš„æ­¦å™¨ï¼š**æŠ½æ°´ (Margin)**ã€‚åªè¦èµ”ç‡ä¹˜æ¦‚ç‡çš„å’Œå°äº1ï¼Œç©å®¶å¿…äºã€‚")

# åº•éƒ¨å£°æ˜
st.caption("âš ï¸ å…è´£å£°æ˜ï¼šæœ¬å·¥å…·ä»…ç”¨äºæ•°å­¦é€»è¾‘æ¼”ç¤ºï¼Œä¸æ„æˆä»»ä½•åšå½©å»ºè®®ã€‚è¯·ç†æ€§çœ‹å¾…åšå½©é£é™©ã€‚")
